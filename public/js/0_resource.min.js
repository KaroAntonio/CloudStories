function increase_brightness(e,t){e=e.replace(/^\s*#|\s*$/g,""),3==e.length&&(e=e.replace(/(.)/g,"$1$1"))
var n=parseInt(e.substr(0,2),16),r=parseInt(e.substr(2,2),16),i=parseInt(e.substr(4,2),16)
return"#"+(0|256+n+(256-n)*t/100).toString(16).substr(1)+(0|256+r+(256-r)*t/100).toString(16).substr(1)+(0|256+i+(256-i)*t/100).toString(16).substr(1)}function inverse(e){if(7!=e.length||0!=e.indexOf("#"))return null
var t=(255-parseInt(e.substring(1,3),16)).toString(16),n=(255-parseInt(e.substring(3,5),16)).toString(16),r=(255-parseInt(e.substring(5,7),16)).toString(16),i="#"+pad(t)+pad(n)+pad(r)
return i}function pad(e){return e.length<2?"0"+e:e}function createContext(){var e=new Array(1e3)
e[0]="The sky",e[1]="Everything and more",e[2]="The clear star that is yesterday",e[3]="Tomorrow",e[4]="An old apple",e[5]="Camouflage paint",e[6]="A sound you heard",e[7]="A setback of the heart",e[8]="The body of mind",e[9]="A classical composition",e[10]="Another day",e[11]="Chair number eleven",e[12]="Nihilism",e[13]="Tranquility",e[14]="Wondrous awe",e[15]="That memory we used to share",e[16]="Nothing of importance",e[17]="Clear water",e[18]="Gasoline",e[19]="Sixty-four",e[20]="Nothingness",e[21]="The flow of quizzes",e[22]="An enigma",e[23]="A wave loudly clashing against a long shoreline",e[24]="Stupidity",e[25]="Love",e[26]="Sex",e[27]="An idea",e[28]="The last sentence you saw",e[29]="The person you were before",e[30]="A flailing monkey",e[31]="Organisational culture",e[32]="Trickery",e[33]="A caring mother",e[34]="A sickingly prodigous profile",e[35]="A fly",e[36]="Two-finger John",e[37]="Sevenworm",e[38]="Pinocchio",e[39]="Lucky number slevin",e[40]="A shooting star",e[41]="Whiskey on the table",e[42]="A cranky old lady",e[43]="Stew and rum",e[44]="Spam",e[45]="Lonely Henry",e[46]="Style",e[47]="Fashion",e[48]="A principal idea",e[49]="Too long a stick",e[50]="A glittering gem",e[51]="That way",e[52]="Significant understanding",e[53]="Passion or serendipity",e[54]="A late night",e[55]="A stumbling first step",e[56]="That stolen figurine",e[57]="A token of gratitude",e[58]="A small mercy",e[59]="Utter nonsense",e[60]="Colorful clay",e[61]="Insignificance",e[62]="The light at the end of the tunnel",e[63]="The other side",e[64]="Abstraction",e[65]="Rock music",e[66]="A passionate evening",e[67]="A great silence",e[68]="A river a thousand paces wide",e[69]="The legend of the raven's roar",e[70]="Enqoyism"
var t=new Array(1e3)
t[0]="is like a painted flower; it never wilts.",t[1]="runs through everything.",t[2]="is ever present.",t[3]="lies ahead, what with the future yet to come.",t[4]="approaches at high velocity!",t[5]="is nonsensical, much like me.",t[6]="likes to take a walk in the park.",t[7]="is still not very coherent.",t[8]="loves to love.",t[9]="would die for a grapefruit!",t[10]="sickens me.",t[11]="has your skin crawling.",t[12]="makes people shiver.",t[13]="is always a pleasure.",t[14]="could please even the most demanding follower of Freud.",t[15]="slips on a banana peel.",t[16]="is nothing at all?",t[17]="doesn't like paying taxes.",t[18]="would kindly inquire something about you.",t[19]="is not yet ready to die.",t[20]="is omni-present, much like candy.",t[21]="is good for you.",t[22]="does not make any sense.",t[23]="gambles with lives, happiness, and even destiny itself!",t[24]="would scare any linguist away.",t[25]="sees the sun.",t[26]="is running away.",t[27]="jumps both ways.",t[28]="can get both high and low.",t[29]="tests the thesis that your theorem would unleash.",t[30]="comes asking for bread.",t[31]="is interdependant on the relatedness of motivation, subcultures, and management.",t[32]="says hello.",t[33]="tenderly sees to her child.",t[34]="wants to go to hell.",t[35]="is often pregnant.",t[36]="is often one floor above you.",t[37]="likes to have a shower in the morning.",t[38]="wants to set things right.",t[39]="tells the tale of towers.",t[40]="stole the goods.",t[41]="woke the prime minister.",t[42]="shot the sheriff.",t[43]="lay down on the riverbed.",t[44]="asked you a question?",t[45]="sat down once more.",t[46]="shoots pineapples with a machinegun.",t[47]="will take you to places you never expected not to visit!",t[48]="revels in authority.",t[49]="stands upon somebody else's legs.",t[50]="visits Japan in the winter.",t[51]="says goodbye to the shooter.",t[52]="welcomes spring!",t[53]="loves a good joke!",t[54]="is a storyteller without equal.",t[55]="rains heavily.",t[56]="is like a summer breeze.",t[57]="is f***ing cosmopolitan, having a trained assassin stay overnight, letting heartbreaking lies roll over us like a summer breeze.",t[58]="wanted the TRUTH!",t[59]="set a treehouse on fire.",t[60]="bathes in sunlight.",t[61]="has its world rocked by trees (or rocks).",t[62]="ever stuns the onlooker.",t[63]="brings both pleasure and pain.",t[64]="takes the world for granted.",t[65]="is not enough.",t[66]="was always the second best.",t[67]="is not all that great.",t[68]="shakes beliefs widely held.",t[69]="always strikes for the heart.",t[70]="is belief in the interrelatedness of all things."
var n=0,r=0,i=71,o=71,s={i1:n,i2:r,nx:i,vx:o,n:e,v:t}
return s}function generate(e,t){var t=createContext()
return 1==e?t.i1=get_random(t.nx):2==e?t.i2=get_random(t.vx):(t.i1=get_random(t.nx),t.i2=get_random(t.vx)),t.n[t.i1]+" "+t.v[t.i2]}function qrand(e){return RandSeed=(RandMultiplier*RandSeed+RandIncrement)%2147483647,(RandSeed>>16)%e}function qinit(){RandMultiplier=22695477,RandIncrement=1
var e=new Date
RandSeed=e.getTime()%4294967295,FirstSentence=1,FirstAmerica=1}function GenRandomSentenceTemplate(){var e="",t=17,n=qrand(t+5)
return n>t?e="1 2 1.":1==n?e="1 2 1, 3 1 2 1.":2==n?e="When 1 4, 1 4.":3==n?e="If 1 2 1, then 1 4.":4==n?e="Sometimes 1 4, but 1 always 2 1!":5==n?e="Most people believe that 1 2 1, but they need to remember how 7 1 4.":6==n?FirstAmerica?(FirstAmerica=0,e="1, 1, and 1 are what made America great!"):e="1 2 1.":7==n?e="1 4, 3 1 2 1.":8==n?e="Now and then, 1 2 1.":9==n?e="1 4, and 1 4; however, 1 2 1.":10==n?e=FirstSentence?"1 2 1.":"Indeed, 1 2 1.":11==n?e=FirstSentence?"1 2 1.":"Furthermore, 1 4, and 1 2 1.":12==n?e=FirstSentence?"1 2 1.":"For example, 1 indicates that 1 2 1.":13==n?e="When you see 1, it means that 1 4.":14==n?e="Any 0 can 5 1, but it takes a real 0 to 5 1.":15==n?e="1 is 6.":16==n&&(e="When 1 is 6, 1 2 1."),FirstSentence=0,e}function GenNoun(){var e=125,t=qrand(e),n=""
return 0==t?n="cocker spaniel":1==t?n="roller coaster":2==t?n="abstraction":3==t?n="pine cone":4==t?n="microscope":5==t?n="bottle of beer":6==t?n="bowling ball":7==t?n="grain of sand":8==t?n="wheelbarrow":9==t?n="pork chop":10==t?n="bullfrog":11==t?n="squid":12==t?n="tripod":13==t?n="girl scout":14==t?n="light bulb":15==t?n="hole puncher":16==t?n="carpet tack":17==t?n="submarine":18==t?n="diskette":19==t?n="tape recorder":20==t?n="anomaly":21==t?n="insurance agent":22==t?n="mortician":23==t?n="fire hydrant":24==t?n="photon":25==t?n="line dancer":26==t?n="paper napkin":27==t?n="stovepipe":28==t?n="graduated cylinder":29==t?n="hydrogen atom":30==t?n="garbage can":31==t?n="reactor":32==t?n="power drill":33==t?n="scooby snack":34==t?n="freight train":35==t?n="ocean":36==t?n="bartender":37==t?n="senator":38==t?n="mating ritual":39==t?n="briar patch":40==t?n="jersey cow":41==t?n="chain saw":42==t?n="prime minister":43==t?n="cargo bay":44==t?n="buzzard":45==t?n="polar bear":46==t?n="tomato":47==t?n="razor blade":48==t?n="ball bearing":49==t?n="fighter pilot":50==t?n="support group":51==t?n="fundraiser":52==t?n="cowboy":53==t?n="football team":54==t?n="cab driver":55==t?n="nation":56==t?n="ski lodge":57==t?n="mastadon":58==t?n="recliner":59==t?n="minivan":60==t?n="deficit":61==t?n="food stamp":62==t?n="wedding dress":63==t?n="fairy":64==t?n="globule":65==t?n="movie theater":66==t?n="tornado":67==t?n="rattlesnake":68==t?n="CEO":69==t?n="corporation":70==t?n="plaintiff":71==t?n="class action suit":72==t?n="judge":73==t?n="defendant":74==t?n="dust bunny":75==t?n="vacuum cleaner":76==t?n="lover":77==t?n="sandwich":78==t?n="hockey player":79==t?n="avocado pit":80==t?n="fruit cake":81==t?n="turkey":82==t?n="sheriff":83==t?n="apartment building":84==t?n="industrial complex":85==t?n="inferiority complex":86==t?n="salad dressing":87==t?n="short order cook":88==t?n="pig pen":89==t?n="grand piano":90==t?n="tuba player":91==t?n="traffic light":92==t?n="turn signal":93==t?n="paycheck":94==t?n="blood clot":95==t?n="earring":96==t?n="blithe spirit":97==t?n="customer":98==t?n="warranty":99==t?n="grizzly bear":100==t?n="cyprus mulch":101==t?n="pit viper":102==t?n="crank case":103==t?n="oil filter":104==t?n="steam engine":105==t?n="chestnut":106==t?n="chess board":107==t?n="pickup truck":108==t?n="cheese wheel":109==t?n="eggplant":110==t?n="umbrella":111==t?n="skyscraper":112==t?n="dolphin":113==t?n="asteroid":114==t?n="parking lot":115==t?n="demon":116==t?n="tabloid":117==t?n="particle accelerator":118==t?n="cloud formation":119==t?n="cashier":120==t?n="burglar":121==t?n="spider":122==t?n="cough syrup":123==t?n="satellite":124==t&&(n="scythe"),n}function GenPreposition(){var e=14,t=qrand(e),n=""
return 0==t?n="of":1==t?n="from":2==t?n="near":3==t?n="about":4==t?n="around":5==t?n="for":6==t?n="toward":7==t?n="over":8==t?n="behind":9==t?n="beyond":10==t?n="related to":11==t?n="defined by":12==t?n="inside":13==t&&(n="living with"),n}function GenNounPhrase(e){var t=qrand(3),n=""
0==t||e>0?n=GenNoun():1==t?n=GenAdjective()+" "+GenNoun():2==t&&(n=GenNoun()+" "+GenPreposition()+" "+GenNounPhrase(e+1))
var r=qrand(100)
if(30>r)n="the "+n
else if(35>r)n="another "+n
else if(40>r)n="some "+n
else{var i=n.substring(0,1).toLowerCase()
n="Eurasian"==n.substring(0,8)||"a"!=i&&"e"!=i&&"i"!=i&&"o"!=i&&"u"!=i?"a "+n:"an "+n}return n}function GenAdverb(){var e=28,t=qrand(e),n=""
return 0==t?n="knowingly":1==t?n="slyly":2==t?n="greedily":3==t?n="hesitantly":4==t?n="secretly":5==t?n="carelessly":6==t?n="thoroughly":7==t?n="barely":8==t?n="ridiculously":9==t?n="non-chalantly":10==t?n="hardly":11==t?n="eagerly":12==t?n="feverishly":13==t?n="lazily":14==t?n="inexorably":15==t?n="accurately":16==t?n="accidentally":17==t?n="completely":18==t?n="usually":19==t?n="single-handledly":20==t?n="underhandedly":21==t?n="almost":22==t?n="wisely":23==t?n="ostensibly":24==t?n="somewhat":25==t?n="overwhelmingly":26==t?n="seldom":27==t&&(n="often"),n}function GenAdjective(){var e=105,t=qrand(e),n=""
return 0==t?n="slow":1==t?n="surly":2==t?n="gentle":3==t?n="optimal":4==t?n="treacherous":5==t?n="loyal":6==t?n="smelly":7==t?n="ravishing":8==t?n="annoying":9==t?n="burly":10==t?n="raspy":11==t?n="moldy":12==t?n="blotched":13==t?n="federal":14==t?n="phony":15==t?n="magnificent":16==t?n="alleged":17==t?n="crispy":18==t?n="gratifying":19==t?n="elusive":20==t?n="revered":21==t?n="spartan":22==t?n="righteous":23==t?n="mysterious":24==t?n="worldly":25==t?n="cosmopolitan":26==t?n="college-educated":27==t?n="bohemian":28==t?n="statesmanlike":29==t?n="stoic":30==t?n="hypnotic":31==t?n="dirt-encrusted":32==t?n="purple":33==t?n="infected":34==t?n="shabby":35==t?n="tattered":36==t?n="South American":37==t?n="Alaskan":38==t?n="overripe":39==t?n="self-loathing":40==t?n="frustrating":41==t?n="rude":42==t?n="pompous":43==t?n="impromptu":44==t?n="makeshift":45==t?n="so-called":46==t?n="proverbial":47==t?n="molten":48==t?n="wrinkled":49==t?n="psychotic":50==t?n="foreign":51==t?n="familiar":52==t?n="pathetic":53==t?n="precise":54==t?n="moronic":55==t?n="polka-dotted":56==t?n="varigated":57==t?n="mean-spirited":58==t?n="false":59==t?n="linguistic":60==t?n="temporal":61==t?n="fractured":62==t?n="dreamlike":63==t?n="imaginative":64==t?n="cantankerous":65==t?n="obsequious":66==t?n="twisted":67==t?n="load bearing":68==t?n="orbiting":69==t?n="radioactive":70==t?n="unstable":71==t?n="outer":72==t?n="nearest":73==t?n="most difficult":74==t?n="Eurasian":75==t?n="hairy":76==t?n="flabby":77==t?n="soggy":78==t?n="muddy":79==t?n="salty":80==t?n="highly paid":81==t?n="greasy":82==t?n="fried":83==t?n="frozen":84==t?n="boiled":85==t?n="incinerated":86==t?n="vaporized":87==t?n="nuclear":88==t?n="paternal":89==t?n="childlike":90==t?n="feline":91==t?n="fat":92==t?n="skinny":93==t?n="green":94==t?n="financial":95==t?n="frightened":96==t?n="fashionable":97==t?n="resplendent":98==t?n="flatulent":99==t?n="mitochondrial":100==t?n="overpriced":101==t?n="snooty":102==t?n="self-actualized":103==t?n="miserly":104==t&&(n="geosynchronous"),qrand(10)>7&&(n=GenAdverb()+" "+n),n}function GenTransitiveVerbPhrase(e){var t=56,n=qrand(t),r=""
0==n?r="eat$":1==n?r="conquer$":2==n?r="figure$ out":3==n?r="know$":4==n?r="teach*":5==n?r="require$ assistance from":6==n?r="pour$ freezing cold water on":7==n?r="find$ lice on":8==n?r="seek$":9==n?r="ignore$":10==n?r="dance$ with":11==n?r="recognize$":12==n?r="compete$ with":13==n?r="reach* an understanding with":14==n?r="negotiate$ a prenuptial agreement with":15==n?r="assimilate$":16==n?r="bestow$ great honor upon":17==n?r="derive$ perverse satisfaction from":18==n?r="steal$ pencils from":19==n?r="tr& to seduce":20==n?r="go* deep sea fishing with":21==n?r="find$ subtle faults with":22==n?r="laugh$ and drink$ all night with":23==n?r="befriend$":24==n?r="make$ a truce with":25==n?r="give$ secret financial aid to":26==n?r="brainwash*":27==n?r="trade$ baseball cards with":28==n?r="sell$ "+GenNounPhrase(0)+" to":29==n?r="caricature$":30==n?r="sanitize$":31==n?r="satiate$":32==n?r="organize$":33==n?r="graduate$ from":34==n?r="give$ lectures on morality to":35==n?r="^ a change of heart about":36==n?r="play$ pinochle with":37==n?r="give$ a pink slip to":38==n?r="share$ a shower with":39==n?r="buy$ an expensive gift for":40==n?r="cook$ cheese grits for":41==n?r="take$ a peek at":42==n?r="pee$ on":43==n?r="write$ a love letter to":44==n?r="fall$ in love with":45==n?r="avoid$ contact with":46==n?r=") a big fan of":47==n?r="secretly admire$":48==n?r="borrow$ money from":49==n?r="operate$ a small fruit stand with":50==n?r="throw$ "+GenNounPhrase(0)+" at":51==n?r="bur&":52==n?r="can be kind to":53==n?r="learn$ a hard lesson from":54==n?r="plan$ an escape from "+GenNounPhrase(0):55==n&&(r="make$ love to"),vt=""
var i
for(i=0;i<r.length;i++){var o=r.substring(i,i+1),s=o
"$"==o?0==e?s="":1==e&&(s="s"):"*"==o?0==e?s="":1==e&&(s="es"):")"==o?0==e?s="be":1==e&&(s="is"):"^"==o?0==e?s="have":1==e&&(s="has"):"&"==o&&(0==e?s="y":1==e&&(s="ies")),vt+=s}return qrand(10)<3&&(vt=GenAdverb()+" "+vt),vt}function GenIntransitiveVerbPhrase(){var e=28,t=qrand(e),n=""
return 0==t?n="leaves":1==t?n="goes to sleep":2==t?n="takes a coffee break":3==t?n="hibernates":4==t?n="reads a magazine":5==t?n="self-flagellates":6==t?n="meditates":7==t?n="starts reminiscing about lost glory":8==t?n="flies into a rage":9==t?n="earns frequent flier miles":10==t?n="sweeps the floor":11==t?n="feels nagging remorse":12==t?n="returns home":13==t?n="rejoices":14==t?n="prays":15==t?n="procrastinates":16==t?n="daydreams":17==t?n="ceases to exist":18==t?n="hides":19==t?n="panics":20==t?n="beams with joy":21==t?n="laughs out loud":22==t?n="gets stinking drunk":23==t?n="wakes up":24==t?n="hesitates":25==t?n="trembles":26==t?n="ruminates":27==t&&(n="dies"),n}function GenConjunction(){var e=4,t=qrand(e),n=""
return 0==t?n="and":1==t?n="or":2==t?n="but":3==t&&(n="because"),n}function CapFirst(e){return e.substring(0,1).toUpperCase()+e.substring(1,e.length)}function GenRandomSentence(){var e,t=GenRandomSentenceTemplate(),n=""
for(e=0;e<t.length;e++){var r=t.substring(e,e+1),i=""
i="0"==r?GenNoun():"1"==r?GenNounPhrase(0):"2"==r?GenTransitiveVerbPhrase(1):"3"==r?GenConjunction():"4"==r?GenIntransitiveVerbPhrase():"5"==r?GenTransitiveVerbPhrase(0):"6"==r?GenAdjective():"7"==r?GenAdverb():r,n+=i}return CapFirst(n)}function listen_for_bumps(){if("undefined"!=typeof EventSource){var e=new EventSource("/updateStories.php")
e.onmessage=function(e){var t=JSON.parse(e.data)
storyLine[0].id==Number(t[0])&&(requestSubtree(Number(t[0])),null!=findLine(t[1])&&(buildStoryLine(t[1]),branches=findBranches(t[1]),drawAll()))}}}function initPrefs(e){return"tips_enabled"in e?"true"===e.tips_enabled?e.tips_enabled=!0:e.tips_enabled=!1:e.tips_enabled=!0,e}function postPreferences(e){$.ajaxSetup({headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")}})
$.post("update_prefs",e,onSuccess)}function onSuccess(e,t,n){console.log(e,t,n)}function stripHTML(e){var t=document.createElement("DIV")
return t.innerHTML=e,t.textContent||t.innerText||""}function disable_form(e){$(e).on("keyup keypress",function(e){var t=e.keyCode||e.which
return 13==t?(e.preventDefault(),!1):void 0})}function releaseKey(e){16==e&&(shiftDown=!1)}function triggerKey(e){document.forms.line_form.line.value.trim()
return"line"==document.activeElement.name?void(13==e&&submitForm()):($("#line").blur(),void(13==e?clickStory(null==selected?storyLine[0]:selected):16==e?(shiftDown=!0,storyLine.length>0&&clickStory(storyLine[1])):38==e&&shiftDown&&storyLine.length>0&&clickStory(storyLine[1])))}function get_random(e){var t=Math.floor(Math.random()*e)
return t}function buildStoryLine(e){if(null!=findLine(e)){for(storyLine=[findLine(e)],storyLine[0].top=isTop(e);1!=storyLine[storyLine.length-1].id;){var t=findLine(storyLine[storyLine.length-1].parentID)
if(null==t)break
t.top=isTop(t.id),storyLine.push(t)}branches=findBranches(storyLine[0].id)}}function isTop(e){for(var t=findLine(e),n=findBranches(t.parentID),r=0,i=0;i<n.length;i++)Number(n[i].visits)>r&&(r=n[i].visits)
return Number(t.visits)>=Number(r)}function findBranches(e){var t=[]
for(i=0;i<stories.length;i++)stories[i].parentID==e&&t.push(stories[i])
return t}function findLine(e){for(i=0;i<stories.length;i++)if(stories[i].id==e)return stories[i]
return null}function requestSubtree(id,depth,callback){var xmlhttp
return xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),void 0==id&&(id=1),xmlhttp.open("GET","/get_subtree/"+id+"/"+depth,!0),xmlhttp.send(),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){var subtree=eval("("+xmlhttp.responseText+")")
appendSubtree(subtree),0==branches.length&&showStory(storyLine[0].id),void 0!==callback&&("click"==callback?clickStory(subtree[0]):callback())}},!0}function appendSubtree(e){storyIDs=[]
for(var t=0;t<stories.length;t++)storyIDs.push(Number(stories[t].id))
for(var t=0;t<e.length;t++)-1==storyIDs.indexOf(Number(e[t].id))&&stories.push(e[t])}function showStory(e){buildStoryLine(e),branches=findBranches(e),drawAll()}function clickStory(e){null!=e&&set_cookie("last_line_id",e.id,200),null!=e&&(null!=user&&(user.experience+=1),-1!=e.id?(showStory(e.id),requestSubtree(e.id,subtree_depth)):($("#line").val(e.line),submitForm()))}function suggestLine(){var e=[function(){return generate()},function(){return qinit(),GenRandomSentence()}],t=e[get_random(e.length-1)]()
$("#line").val(t)}function submitForm(){var e=document.forms.line_form.line.value.trim()
e=stripHTML(e),$("#line").val(e)
var t=e.toLowerCase()
if(""==t)return 0!=branches&&clickStory(branches[0]),void("line"==document.activeElement.name&&$("#line").blur())
for(var n=findBranches(storyLine[0].id),r=0;r<n.length;r++)if(n[r].line.toLowerCase()==t)return clickStory(n[r]),void $("#line").val("")
$("#parentID").val(storyLine[0].id)
var i=null==user?0:user.id
$("#authorID").val(i)
var o=$.post("store",$("#line_form").serialize())
$("#line").val(""),o.done(function(e){num_lines++,appendSubtree([e]),clickStory(e)})}function initTips(){hideTip()
for(var e=Object.keys(tip_library),t=0;t<e.length;t++)$(e[t]).on("mouseover",function(e){return function(){showTip(e,"#tips_container")}}(e[t])),$(e[t]).on("mouseout",function(e){return function(){hideTip(e)}}(e[t]))}function disableTips(){tips_enabled=!1,$("#tips_container")[0].innerHTML="",preferences.tips_enabled=!1,postPreferences(preferences),set_cookie("tips_enabled",!1,200)}function hideTip(e){tips_enabled&&(showTip("default","#tips_container"),$(e).css("background","transparent"),$(e).css("border","none"))}function showTip(e,t,n,r,i){if(n="undefined"!=typeof n?n:!0,r="undefined"!=typeof r?r:!1,i="undefined"!=typeof i?i:tip_library,tips_enabled){var o=i[e]
$(t)[0].innerHTML=""
var s=""
n&r&&(s+="<div class='large_tip_title'>"+o.title+"</div>"),n&!r&&(s+="<div class='tip_title'>"+o.title+"</div>"),s+=r?"<div class='large_tip_content'>"+o.content+"</div>":"<div class='tip_content'>"+o.content+"</div>",$(t)[0].innerHTML=s}}function getTipKey(e,t){return Object.keys(e)[t]}function showBannerTip(e){showTip(getTipKey(intro_library,e),"#banner_tips",0!=e,!0,intro_library),$("#banner_nav")[0].innerHTML="",$("#banner_nav")[0].innerHTML+="<div id='next_button' class='nav_button' onclick='showBannerTip("+(e+1)+")'>NEXT></div>",$("#banner_nav")[0].innerHTML+="<div id='banner_register' class='words_link' onclick='location.href=\"/auth/register\"'><a class='nav_button'>REGISTER<a></div>",$("#banner_nav")[0].innerHTML+="<div id='start_button' class='regular_button'>LATER</div>",void 0==getTipKey(intro_library,e+1)?$("#next_button")[0].style.display="none":($("#banner_register")[0].style.display="none",$("#start_button")[0].style.display="none"),$("#close_tips").on("click",hideBannerTip),$("#start_button").on("click",hideBannerTip),$("#disable_tips").remove()}function hideBannerTip(){$("#veil").css("display","none")}function set_cookie(e,t,n,r){var i=r?"; domain="+r:""
document.cookie=e+"="+encodeURIComponent(t)+"; max-age="+86400*n+"; path=/"+i}function is_cookie(e){var t=document.cookie
if(0!=t.length){var n=t.match(e+"=([^;]*)")
return null!=n}return!1}function get_cookie(e){var t=document.cookie
if(0!=t.length){var n=t.match(e+"=([^;]*)")
return decodeURIComponent(n[1])}return""}function drawAll(){drawStoryLine(),drawBranches(),drawStats(),enableTree&&drawTree()}function drawTree(){initTree()}function drawBackground(){renderStoryShells()}function drawStoryLine(){for($("#story_line").empty(),i=storyLine.length-1;i>=0;i--)drawLine(storyLine[i],colorScale,$("#story_line"))
$("#story_line_container")[0].scrollTop=$("#story_line_container")[0].scrollHeight}function drawBranches(){var e="#eee",t="inset 0 1px 1px rgba(0,0,0,.075), 0 0 5px "+forwardColor,n="inset 0 0 0px "+forwardColor
if($("#line").css("border-color",e),$("#line")[0].style.boxShadow=n,$("#line")[0].style.MozBoxShadow=n,$("#line")[0].style.WebKitBoxShadow=n,$("#line").focus(function(){$(this).css("border-color",forwardColor),$(this)[0].style.boxShadow=t,$(this)[0].style.MozBoxShadow=t,$(this)[0].style.WebKitBoxShadow=t}),$("#line").blur(function(){$(this).css("border-color",e),$(this)[0].style.boxShadow=n,$(this)[0].style.MozBoxShadow=n,$(this)[0].style.WebKitBoxShadow=n}),$("#branches").empty(),branches.length>0){branches.sort(function(e,t){return parseFloat(e.visits)-parseFloat(t.visits)}),branches.reverse()
var r=[]
r[0]=branches.splice(0,1),r[1]=branches.splice(0,1*branches.length/3),r[2]=branches.splice(0,branches.length)
for(var i=0;i<r.length;i++)if(r[i].length>0){var o=Math.floor(Math.random()*r[i].length)
branches.unshift(r[i].splice(o,1)[0])}branches.length>0?selected=branches[branches.length-1]:selected=null,branches.sort(function(e,t){return parseFloat(t.visits)-parseFloat(e.visits)})
var s=backColor
for(0==branches[0].visits&&(s=maxBranchColor),branchColorScale=d3.scale.linear().range([s,maxBranchColor]).domain([0,branches[0].visits]).clamp(!0),branches.length<=3&&$("#branches").height($(".line").height()*branches.length),i=0;i<branches.length;i++)drawLine(branches[i],branchColorScale,$("#branches"),0==i)
for(i=0;i<r.length;i++)for(o=0;o<r[i].length;o++)drawLine(r[i][o],branchColorScale,$("#branches"))}else selected=null,$("#branches").height(10)
0==branches.length&&storyLine.length>1&&document.getElementById("line").focus()}function colorLine(e,t,n,r){"branches"==r[0].id?n.style.color=t(e.visits):n.style.color=t(storyLine.indexOf(e))}function drawLine(e,t,n,r){r="undefined"!=typeof r?r:!1
var o=document.createElement("DIV")
"Anonymous"!=e.author_name&&void 0!=e.author_name&&(o.innerHTML="-"+e.author_name),o.id="info_"+e.id,o.className="info",debug&&(o.innerHTML+=" : "+e.visits)
var s=document.createElement("DIV")
colorLine(e,t,s,n),s.id="line_"+e.id,s.className="line",s.innerHTML=e.line
var a=function(e,t,n){return function(){t.style.color="#aaa",e.style["font-style"]="italic",e.style.color=colorScale(0)}}(s,o,e),l=function(e,r,i,o){return function(){r.style.color="transparent",e.style["font-style"]="normal",colorLine(o,t,s,n)}}(s,o,i,e)
s.onmouseenter=a,o.onmouseenter=a,s.onmouseout=l,o.onmouseout=l,s.onclick=function(e){return function(){clickStory(e)}}(e),n[0].appendChild(o),n[0].appendChild(s),o.style.marginLeft=-o.offsetWidth+"px"}function drawStats(){null!=user&&($("#user_stats")[0].innerHTML=""+user.experience+" // "+user.prestige+" // "+num_lines)}function displayAlphaWarning(){$("#alpha_warning").css("display","block")}function hideAlphaWarning(){$("#alpha_warning").css("display","none")}function setup(){var e=createCanvas(window.innerWidth,window.innerHeight)
e.parent("background")}function renderStoryShells(){background("#fff")
for(var e=50,t=storyLine.length-1;t>=0;t--)fill(stringColor(storyLine[t].line,forwardColor,.95)),noStroke(),ellipse(window.innerWidth/2,window.innerHeight/2,t*e,t*e)}function stringColor(e,t,n){for(var r=0,i=0;i<e.length;i++)r+=e.charCodeAt(i)*i
return 1118481>r&&(r+=13118481),shadeColor("#"+(r%16777215).toString(16),n)}function shadeColor(e,t){var n=parseInt(e.slice(1),16),r=0>t?0:255,i=0>t?-1*t:t,o=n>>16,s=n>>8&255,a=255&n
return"#"+(16777216+65536*(Math.round((r-o)*i)+o)+256*(Math.round((r-s)*i)+s)+(Math.round((r-a)*i)+a)).toString(16).slice(1)}function blendColors(e,t,n){var r=parseInt(e.slice(1),16),i=parseInt(t.slice(1),16),o=r>>16,s=r>>8&255,a=255&r,l=i>>16,c=i>>8&255,u=255&i
return"#"+(16777216+65536*(Math.round((l-o)*n)+o)+256*(Math.round((c-s)*n)+s)+(Math.round((u-a)*n)+a)).toString(16).slice(1)}function buildTree(e,t){var n=findLine(t),r=[n]
if("0"!=n.parentID){var i=findLine(n.parentID)
i.children=[n],n=i}for(;r.length>0;){var o=r[0]
r.splice(0,1),o.children=findBranches(o.id),r=r.concat(o.children)}return n}function initTree(){var e={top:20,right:120,bottom:20,left:120},t=width-e.right-e.left,n=800-e.top-e.bottom
tree=d3.layout.tree().size([height,width]),diagonal=d3.svg.diagonal().projection(function(e){return[e.y+10,e.x]}),$("#tree_container").empty(),svg=d3.select("#tree_container").append("svg").attr("width",t+e.right+e.left).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),root=buildTree(stories,get_cookie("last_line_id")),root.x0=n/2,root.y0=0,update(root)}function update(e){var t=tree.nodes(root).reverse(),n=tree.links(t)
t.forEach(function(e){e.y=180*e.depth})
var r=svg.selectAll("g.node").data(t,function(e){return e.id||(e.id=++node_i)}),i=r.enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+e.y0+","+e.x0+")"}).on("click",click)
i.append("circle").attr("r",1e-6).style("fill",function(e){return e._children?"#FFB2B2":"#fff"}),i.append("text").attr("x",function(e){return e.children||e._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(e){return e.children||e._children?"end":"start"}).text(function(e){return e.line}).attr("transform","rotate(-5)").style("fill-opacity",1e-6)
var o=r.transition().duration(duration).attr("transform",function(e){return"translate("+e.y+","+e.x+")"})
o.select("circle").attr("r",4.5).style("fill",function(e){return e._children?"#FFB2B2":"#fff"}),o.select("text").style("fill-opacity",1)
var s=r.exit().transition().duration(duration).attr("transform",function(t){return"translate("+e.y+","+e.x+")"}).remove()
s.select("circle").attr("r",1e-6),s.select("text").style("fill-opacity",1e-6)
var a=svg.selectAll("path.link").data(n,function(e){return e.target.id})
a.enter().insert("path","g").attr("class","link").attr("d",function(t){var n={x:e.x0,y:e.y0}
return diagonal({source:n,target:n})}),a.transition().duration(duration).attr("d",diagonal),a.exit().transition().duration(duration).attr("d",function(t){var n={x:e.x,y:e.y}
return diagonal({source:n,target:n})}).remove(),t.forEach(function(e){e.x0=e.x,e.y0=e.y})}function click(e){e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),clickStory(e),update(e)}var module,countdown=function(e){function t(e,t){var n=e.getTime()
return e.setMonth(e.getMonth()+t),Math.round((e.getTime()-n)/864e5)}function n(e){var t=e.getTime(),n=new Date(t)
return n.setMonth(e.getMonth()+1),Math.round((n.getTime()-t)/864e5)}function r(e,t){if(t=t instanceof Date||null!==t&&isFinite(t)?new Date(+t):new Date,!e)return t
var n=+e.value||0
return n?(t.setTime(t.getTime()+n),t):((n=+e.milliseconds||0)&&t.setMilliseconds(t.getMilliseconds()+n),(n=+e.seconds||0)&&t.setSeconds(t.getSeconds()+n),(n=+e.minutes||0)&&t.setMinutes(t.getMinutes()+n),(n=+e.hours||0)&&t.setHours(t.getHours()+n),(n=+e.weeks||0)&&(n*=7),(n+=+e.days||0)&&t.setDate(t.getDate()+n),(n=+e.months||0)&&t.setMonth(t.getMonth()+n),(n=+e.millennia||0)&&(n*=10),(n+=+e.centuries||0)&&(n*=10),(n+=+e.decades||0)&&(n*=10),(n+=+e.years||0)&&t.setFullYear(t.getFullYear()+n),t)}function i(e,t){return y(e)+(1===e?c[t]:u[t])}function o(){}function s(e,t,r,i,o,s){if(0<=e[r]&&(t+=e[r],delete e[r]),t/=o,1>=t+1)return 0
if(0<=e[i]){switch(e[i]=+(e[i]+t).toFixed(s),i){case"seconds":if(60!==e.seconds||isNaN(e.minutes))break
e.minutes++,e.seconds=0
case"minutes":if(60!==e.minutes||isNaN(e.hours))break
e.hours++,e.minutes=0
case"hours":if(24!==e.hours||isNaN(e.days))break
e.days++,e.hours=0
case"days":if(7!==e.days||isNaN(e.weeks))break
e.weeks++,e.days=0
case"weeks":if(e.weeks!==n(e.refMonth)/7||isNaN(e.months))break
e.months++,e.weeks=0
case"months":if(12!==e.months||isNaN(e.years))break
e.years++,e.months=0
case"years":if(10!==e.years||isNaN(e.decades))break
e.decades++,e.years=0
case"decades":if(10!==e.decades||isNaN(e.centuries))break
e.centuries++,e.decades=0
case"centuries":if(10!==e.centuries||isNaN(e.millennia))break
e.millennia++,e.centuries=0}return 0}return t}function a(e,r,i,o,a,l){var c=new Date
e.start=r=r||c,e.end=i=i||c,e.units=o,e.value=i.getTime()-r.getTime(),0>e.value&&(c=i,i=r,r=c),e.refMonth=new Date(r.getFullYear(),r.getMonth(),15,12,0,0)
try{e.millennia=0,e.centuries=0,e.decades=0,e.years=i.getFullYear()-r.getFullYear(),e.months=i.getMonth()-r.getMonth(),e.weeks=0,e.days=i.getDate()-r.getDate(),e.hours=i.getHours()-r.getHours(),e.minutes=i.getMinutes()-r.getMinutes(),e.seconds=i.getSeconds()-r.getSeconds(),e.milliseconds=i.getMilliseconds()-r.getMilliseconds()
var u
for(0>e.milliseconds?(u=g(-e.milliseconds/1e3),e.seconds-=u,e.milliseconds+=1e3*u):1e3<=e.milliseconds&&(e.seconds+=b(e.milliseconds/1e3),e.milliseconds%=1e3),0>e.seconds?(u=g(-e.seconds/60),e.minutes-=u,e.seconds+=60*u):60<=e.seconds&&(e.minutes+=b(e.seconds/60),e.seconds%=60),0>e.minutes?(u=g(-e.minutes/60),e.hours-=u,e.minutes+=60*u):60<=e.minutes&&(e.hours+=b(e.minutes/60),e.minutes%=60),0>e.hours?(u=g(-e.hours/24),e.days-=u,e.hours+=24*u):24<=e.hours&&(e.days+=b(e.hours/24),e.hours%=24);0>e.days;)e.months--,e.days+=t(e.refMonth,1)
if(7<=e.days&&(e.weeks+=b(e.days/7),e.days%=7),0>e.months?(u=g(-e.months/12),e.years-=u,e.months+=12*u):12<=e.months&&(e.years+=b(e.months/12),e.months%=12),10<=e.years&&(e.decades+=b(e.years/10),e.years%=10,10<=e.decades&&(e.centuries+=b(e.decades/10),e.decades%=10,10<=e.centuries&&(e.millennia+=b(e.centuries/10),e.centuries%=10))),r=0,!(1024&o)||r>=a?(e.centuries+=10*e.millennia,delete e.millennia):e.millennia&&r++,!(512&o)||r>=a?(e.decades+=10*e.centuries,delete e.centuries):e.centuries&&r++,!(256&o)||r>=a?(e.years+=10*e.decades,delete e.decades):e.decades&&r++,!(128&o)||r>=a?(e.months+=12*e.years,delete e.years):e.years&&r++,!(64&o)||r>=a?(e.months&&(e.days+=t(e.refMonth,e.months)),delete e.months,7<=e.days&&(e.weeks+=b(e.days/7),e.days%=7)):e.months&&r++,!(32&o)||r>=a?(e.days+=7*e.weeks,delete e.weeks):e.weeks&&r++,!(16&o)||r>=a?(e.hours+=24*e.days,delete e.days):e.days&&r++,!(8&o)||r>=a?(e.minutes+=60*e.hours,delete e.hours):e.hours&&r++,!(4&o)||r>=a?(e.seconds+=60*e.minutes,delete e.minutes):e.minutes&&r++,!(2&o)||r>=a?(e.milliseconds+=1e3*e.seconds,delete e.seconds):e.seconds&&r++,!(1&o)||r>=a){var d=s(e,0,"milliseconds","seconds",1e3,l)
if(d&&(d=s(e,d,"seconds","minutes",60,l))&&(d=s(e,d,"minutes","hours",60,l))&&(d=s(e,d,"hours","days",24,l))&&(d=s(e,d,"days","weeks",7,l))&&(d=s(e,d,"weeks","months",n(e.refMonth)/7,l))){o=d
var h,f=e.refMonth,p=f.getTime(),y=new Date(p)
if(y.setFullYear(f.getFullYear()+1),h=Math.round((y.getTime()-p)/864e5),(d=s(e,o,"months","years",h/n(e.refMonth),l))&&(d=s(e,d,"years","decades",10,l))&&(d=s(e,d,"decades","centuries",10,l))&&(d=s(e,d,"centuries","millennia",10,l)))throw Error("Fractional unit overflow")}}}finally{delete e.refMonth}return e}function l(e,t,n,i,s){var l
n=+n||222,i=i>0?i:NaN,s=s>0?20>s?Math.round(s):20:0
var c=null
"function"==typeof e?(l=e,e=null):e instanceof Date||(null!==e&&isFinite(e)?e=new Date(+e):("object"==typeof c&&(c=e),e=null))
var u=null
if("function"==typeof t?(l=t,t=null):t instanceof Date||(null!==t&&isFinite(t)?t=new Date(+t):("object"==typeof t&&(u=t),t=null)),c&&(e=r(c,t)),u&&(t=r(u,e)),!e&&!t)return new o
if(!l)return a(new o,e,t,n,i,s)
var d,c=1&n?1e3/30:2&n?1e3:4&n?6e4:8&n?36e5:16&n?864e5:6048e5,u=function(){l(a(new o,e,t,n,i,s),d)}
return u(),d=setInterval(u,c)}var c,u,d,h,f,p,y,m,g=Math.ceil,b=Math.floor
o.prototype.toString=function(e){var t=m(this),n=t.length
return n?1===n?t[0]:(e=d+t.pop(),t.join(h)+e):e?""+e:f},o.prototype.toHTML=function(e,t){e=e||"span"
var n=m(this),r=n.length
if(!r)return(t=t||f)?"<"+e+">"+t+"</"+e+">":t
for(var i=0;r>i;i++)n[i]="<"+e+">"+n[i]+"</"+e+">"
return 1===r?n[0]:(r=d+n.pop(),n.join(h)+r)},o.prototype.addTo=function(e){return r(this,e)},m=function(e){var t=[],n=e.millennia
return n&&t.push(p(n,10)),(n=e.centuries)&&t.push(p(n,9)),(n=e.decades)&&t.push(p(n,8)),(n=e.years)&&t.push(p(n,7)),(n=e.months)&&t.push(p(n,6)),(n=e.weeks)&&t.push(p(n,5)),(n=e.days)&&t.push(p(n,4)),(n=e.hours)&&t.push(p(n,3)),(n=e.minutes)&&t.push(p(n,2)),(n=e.seconds)&&t.push(p(n,1)),(n=e.milliseconds)&&t.push(p(n,0)),t},l.MILLISECONDS=1,l.SECONDS=2,l.MINUTES=4,l.HOURS=8,l.DAYS=16,l.WEEKS=32,l.MONTHS=64,l.YEARS=128,l.DECADES=256,l.CENTURIES=512,l.MILLENNIA=1024,l.DEFAULTS=222,l.ALL=2047
var v=l.setFormat=function(e){if(e){if("singular"in e||"plural"in e){var t=e.singular||[]
t.split&&(t=t.split("|"))
var n=e.plural||[]
n.split&&(n=n.split("|"))
for(var r=0;10>=r;r++)c[r]=t[r]||c[r],u[r]=n[r]||u[r]}"string"==typeof e.last&&(d=e.last),"string"==typeof e.delim&&(h=e.delim),"string"==typeof e.empty&&(f=e.empty),"function"==typeof e.formatNumber&&(y=e.formatNumber),"function"==typeof e.formatter&&(p=e.formatter)}},w=l.resetFormat=function(){c=" millisecond; second; minute; hour; day; week; month; year; decade; century; millennium".split(";"),u=" milliseconds; seconds; minutes; hours; days; weeks; months; years; decades; centuries; millennia".split(";"),d=" and ",h=", ",f="",y=function(e){return e},p=i}
return l.setLabels=function(e,t,n,r,i,o,s){v({singular:e,plural:t,last:n,delim:r,empty:i,formatNumber:o,formatter:s})},l.resetLabels=w,w(),e&&e.exports?e.exports=l:"function"==typeof window.define&&"undefined"!=typeof window.define.amd&&window.define("countdown",[],function(){return l}),l}(module)
tip_library={"default":{title:"wrdcvlt",content:'[wurd-kuhlt] noun<br>i. a branching story tree<br>ii. an obsessive group that tends lovingly to said tree<br><div id="disable_tips" class="regular_button" onclick="disableTips()">Turn off Tips</div>'},"#story_line":{title:"The Story",content:"this is the past, the words you've already read<br>'SHIFT' moves you back up the story<br>Hold 'SHIFT'+'UP' to fast rewind"},"#branches":{title:"The Branches",content:"these are your options, the future, your posibilities<br>the top branch is the most popular<br>'ENTER' chooses the most popular branch<br>scroll for more options"},".info":{title:"Line Info",content:"who wrote this"},"#line_form":{title:"The Next Line...",content:"is yours to write<br>'ENTER' to submit your words"},"#user_stats":{title:"Literary Stats",content:"experience // readership // oeuvre <br>experience: is earned whenever you do anything <br>readership: the number of lines read x the number of people who read them <br>oeuvre: the number of lines you've written"},"#countdown":{title:"Spread the cvlt",content:"on kickstarter"},"#suggest_line_button":{title:"Get a Suggestion",content:"summon the forces of [the internet] to craft a line"}},intro_library={title:{title:"wrdcvlt",content:'[wurd-kuhlt] noun<br>i. a branching story tree<br>ii. an obsessive group that tends lovingly to said tree<br><div id="disable_tips" class="nav_button" onclick="disableTips()">Turn off Tips</div>'},read:{title:"Read",content:"the story by choosing each line, <br>(it's like a choose your own adventure) <br>'ENTER' chooses the most popular branch"},write:{title:"Write",content:"the story from any line,<br>growing a new branch"},start:{title:"Register",content:"to become a part of the cvlt,<br>or just start wording around..."}}
